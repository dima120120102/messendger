<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–π –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤—Ö–æ–¥–∞ -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <h2 id="modalTitle">–í—Ö–æ–¥</h2>
            <input type="email" id="emailInput" placeholder="Email">
            <input type="password" id="passwordInput" placeholder="–ü–∞—Ä–æ–ª—å">
            <button id="authButton">–í–æ–π—Ç–∏</button>
            <span class="toggle-link" id="toggleAuth">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å!</span>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div class="modal" id="registerModal" style="display: none;">
        <div class="modal-content">
            <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
            <input type="text" id="usernameInput" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            <input type="email" id="registerEmailInput" placeholder="Email">
            <input type="password" id="registerPasswordInput" placeholder="–ü–∞—Ä–æ–ª—å">
            <button id="registerButton">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <span class="toggle-link" id="toggleLogin">–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π–¥–∏—Ç–µ!</span>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è -->
    <div class="modal" id="awaitConfirmationModal" style="display: none;">
        <div class="modal-content">
            <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ Email</h2>
            <p>–ú—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –ø–∏—Å—å–º–æ —Å —Å—Å—ã–ª–∫–æ–π –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∞ –≤–∞—à email. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ, —á—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é.</p>
            <button id="cancelAwaitButton">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div class="modal" id="loadingModal" style="display: none;">
        <div class="modal-content loading-modal">
            <div class="spinner"></div>
            <p>–°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã...</p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="modal" id="viewProfileModal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close-btn">√ó</button>
            <h2 id="viewProfileUsername"></h2>
            <p><strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫:</strong> <span id="viewProfileUniqueUsername"></span></p>
            <div class="profile-picture">
                <img id="viewProfilePicture" src="" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è" style="display: none;">
            </div>
            <p><strong>–û —Å–µ–±–µ:</strong> <span id="viewProfileBio"></span></p>
            <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> <span id="viewProfileBirthdate"></span></p>
            <button id="editProfileButton" style="display: none;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
    <div id="editProfileModal" class="modal" style="display: none;">
        <div class="modal-content">
            <button id="cancelEditProfileButton" class="modal-close-btn">‚úñ</button>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h2>
            <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
            <input id="editUsernameInput" type="text" placeholder="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è">
            <label>–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫:</label>
            <input id="uniqueUsernameInput" type="text" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫">
            <label>–§–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è:</label>
            <input id="profilePictureInput" type="file" accept="image/*">
            <img id="editProfilePicturePreview" style="display: none;" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
            <label>–ë–∏–æ–≥—Ä–∞—Ñ–∏—è:</label>
            <textarea id="bioInput" placeholder="–û —Å–µ–±–µ"></textarea>
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
            <input id="birthdateInput" type="date">
            <button id="saveProfileButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div class="modal" id="createGroupModal" style="display: none;">
        <div class="modal-content group-modal">
            <h2>–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h2>
            <div class="group-avatar-preview">
                <img id="groupAvatarPreview" src="" alt="–ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã" style="display: none;">
                <label for="groupAvatarInput" class="avatar-upload-btn">–í—ã–±—Ä–∞—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
                <input type="file" id="groupAvatarInput" accept="image/*" style="display: none;">
            </div>
            <input type="text" id="groupNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
            <input type="text" id="groupUniqueUsernameInput" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, @MyGroup)">
            <textarea id="groupDescriptionInput" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã"></textarea>
            <div class="group-members-container">
                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                <div id="groupMembersList" class="group-members-list"></div>
            </div>
            <div class="modal-buttons">
                <button id="createGroupButton">–°–æ–∑–¥–∞—Ç—å</button>
                <button id="cancelGroupButton">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div class="modal" id="editGroupModal" style="display: none;">
        <div class="modal-content group-modal">
            <button id="closeEditGroupModal" class="modal-close-btn">‚úñ</button>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—É</h2>
            <div class="group-avatar-preview">
                <img id="editGroupAvatarPreview" src="" alt="–ê–≤–∞—Ç–∞—Ä –≥—Ä—É–ø–ø—ã" style="display: none;">
                <label for="editGroupAvatarInput" class="avatar-upload-btn">–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</label>
                <input type="file" id="editGroupAvatarInput" accept="image/*" style="display: none;">
            </div>
            <input type="text" id="editGroupNameInput" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
            <input type="text" id="editGroupUniqueUsernameInput" placeholder="–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –Ω–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, @MyGroup)">
            <textarea id="editGroupDescriptionInput" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã"></textarea>
            <div id="groupOwnerInfo" class="group-owner-info">
                <h3>–°–æ–∑–¥–∞—Ç–µ–ª—å –≥—Ä—É–ø–ø—ã</h3>
                <div id="groupOwnerDetails"></div>
            </div>
            <div class="group-members-container">
                <div class="group-members-header">
                    <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏</h3>
                    <button id="addMembersButton" class="add-members-btn">–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</button>
                </div>
                <div id="editGroupMembersList" class="group-members-list"></div>
            </div>
            <div class="group-requests" id="groupRequests" style="display: none;"></div>
            <div class="modal-buttons">
                <button id="saveGroupButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button id="leaveGroupButton">–í—ã–π—Ç–∏ –∏–∑ –≥—Ä—É–ø–ø—ã</button>
                <button id="deleteGroupButton">–£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
    <div class="modal" id="deleteGroupConfirmModal" style="display: none;">
        <div class="modal-content confirm-modal">
            <h2>–í—ã —É–≤–µ—Ä–µ–Ω—ã?</h2>
            <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            <label>
                <input type="checkbox" id="deleteGroupConfirmCheckbox">
                –Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ
            </label>
            <div class="modal-buttons">
                <button id="confirmDeleteGroupButton" disabled>–£–¥–∞–ª–∏—Ç—å</button>
                <button id="cancelDeleteGroupButton">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –≥—Ä—É–ø–ø—ã -->
    <div class="modal" id="leaveGroupConfirmModal" style="display: none;">
        <div class="modal-content confirm-modal">
            <h2>–í—ã–π—Ç–∏ –∏–∑ –≥—Ä—É–ø–ø—ã?</h2>
            <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–∫–∏–Ω—É—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É?</p>
            <label>
                <input type="checkbox" id="leaveGroupConfirmCheckbox">
                –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é –≤—ã—Ö–æ–¥
            </label>
            <div class="modal-buttons">
                <button id="confirmLeaveGroupButton" disabled>–í—ã–π—Ç–∏</button>
                <button id="cancelLeaveGroupButton">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π —Å —É—á–∞—Å—Ç–Ω–∏–∫–æ–º -->
    <div class="member-actions-modal" id="memberActionsModal" style="display: none;">
        <button class="member-action-btn" id="removeMemberButton">–£–¥–∞–ª–∏—Ç—å –∏–∑ –≥—Ä—É–ø–ø—ã</button>
        <button class="member-action-btn" id="messageMemberButton">–ù–∞–ø–∏—Å–∞—Ç—å –≤ –õ–°</button>
        <button class="member-action-btn" id="viewMemberProfileButton">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        <button class="member-action-btn" id="toggleAdminButton" style="display: none;">–°–¥–µ–ª–∞—Ç—å –∞–¥–º–∏–Ω–æ–º</button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="modal" id="deleteConfirmModal" style="display: none;">
        <div class="modal-content">
            <h2>–í—ã —É–≤–µ—Ä–µ–Ω—ã?</h2>
            <p>–í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            <label>
                <input type="checkbox" id="deleteConfirmCheckbox">
                –Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ
            </label>
            <button id="confirmDeleteButton" disabled>–£–¥–∞–ª–∏—Ç—å</button>
            <button id="cancelDeleteButton">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è -->
    <div class="modal" id="voicePreviewModal" style="display: none;">
        <div class="modal-content">
            <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</h2>
            <audio id="voicePreviewAudio" controls></audio>
            <div class="modal-buttons">
                <button id="sendVoiceButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                <button id="cancelVoiceButton">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="user-actions">
                <button id="menuButton" class="menu-btn">‚ò∞</button>
                <div class="dropdown-menu" id="dropdownMenu" style="display: none;">
                    <button id="viewMyProfileButton">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</button>
                    <button id="createGroupButtonMenu">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                    <button id="logoutButton">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
                    <button id="deleteProfileButton">–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
                </div>
            </div>
            <div class="search-area">
                <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ @username">
                <button id="clearSearch" class="clear-search-btn" style="display: none;">‚úñ</button>
            </div>
            <div id="contactList"></div>
        </div>
        <div class="messenger">
            <div class="header" id="chatHeader">
                <span>–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞</span>
                <button id="viewContactProfileButton" style="display: none;">üë§</button>
                <button id="editGroupButton" style="display: none;">‚öôÔ∏è</button>
            </div>
            <div class="chat" id="chat"></div>
            <div class="input-area">
                <div class="media-preview" id="mediaPreview" style="display: none;">
                    <img id="previewImage" style="display: none;" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è">
                    <video id="previewVideo" controls style="display: none;"></video>
                    <button id="cancelMediaPreview" class="cancel-media-btn">üóëÔ∏è</button>
                </div>
                <canvas id="audioWaveform" style="display: none;"></canvas>
                <div class="input-controls">
                    <input type="text" id="messageInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ">
                    <label for="messageMediaInput" class="media-btn">üìé</label>
                    <input type="file" id="messageMediaInput" accept="image/jpeg,image/png,image/gif,video/mp4,video/webm" style="display: none;">
                    <button id="recordVoiceBtn" class="media-btn">üé§</button>
                    <button id="sendMessageBtn">‚úàÔ∏è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à JavaScript —Å defer -->
    <script src="script.js" defer></script>
</body>
</html>
